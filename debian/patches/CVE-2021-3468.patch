From: Markus Koschany <apo@debian.org>
Date: Mon, 6 Jun 2022 23:15:36 +0200
Subject: CVE-2021-3468

Bug-Debian: https://bugs.debian.org/984938
Origin: https://github.com/lathiat/avahi/pull/330
---
 avahi-daemon/simple-protocol.c | 5 +++++
 1 file changed, 5 insertions(+)

--- a/avahi-daemon/simple-protocol.c
+++ b/avahi-daemon/simple-protocol.c
@@ -424,6 +424,11 @@ static void client_work(AvahiWatch *watc
         }
     }
 
+    if (events & AVAHI_WATCH_HUP) {
+        client_free(c);
+        return;
+    }
+
     c->server->poll_api->watch_update(
         watch,
         (c->outbuf_length > 0 ? AVAHI_WATCH_OUT : 0) |
